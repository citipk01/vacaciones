SELECT B.NOM_EMP, C.RESPONS, D.DESCRIP, A.COD_MF, C.CB_GEID, TRIM(TRIM(C.PRI_APE_MF) || ' ' || TRIM(C.SEG_APE_MF)) || ',' || TRIM(TRIM(C.PRI_NOM_MF) || ' ' || TRIM(SEG_NOM_MF)) NOMBRE,
 C.FEC_ANTIG, A.DIAS_CALCULADOS, A.DIAS_TOMADOS, A.DIAS_CALCULADOS - A.DIAS_TOMADOS DIAS_RESTANTES, F.DIAS, F.FEC_INI, F.FEC_FIN, A.PERIODO, C.CENCOS_MF --,H.QS_CENCOS
  FROM CB_VAC A, QSEMPRESA B, MAEFUNC_TBL C, CB_RESPON D, CB_VAC_SOL F--, CB_CENCOS H
  WHERE TO_CHAR(  A.PERIODO, 'YYYY') = @PERIODOHASTA
     AND A.COD_EMP = B.COD_EMP
     AND A.COD_MF = C.COD_MF
     AND C.FECHA_EFECTIVA = (SELECT MAX(FECHA_EFECTIVA) FROM MAEFUNC_TBL WHERE COD_MF = C.COD_MF AND to_char(FECHA_EFECTIVA,'yyyy') <= @PERIODOHASTA )
     AND C.SEC_EFECTIVA = (SELECT MAX(SEC_EFECTIVA) FROM MAEFUNC_TBL WHERE COD_MF = C.COD_MF AND FECHA_EFECTIVA = C.FECHA_EFECTIVA)
     AND C.RESPONS =  D.RESPONS(+)
     AND A.COD_MF =  F.COD_MF(+)
     AND A.COD_EMP =  F.COD_EMP(+)
     AND A.PERIODO =  F.PERIODO(+)
	AND A.COD_EMP = @EMPRESA
     AND ( C.RESPONS = @RESPONSABLE
     OR '0' = @RESPONSABLE )
     AND A.COD_MF IN (SELECT DISTINCT COD_MF FROM MAEFUNC)
     --AND C.COD_EMP = H.COD_EMP
     --AND C.CENCOS_MF = H.QS_CENCOS



----------------------
select  a.cod_mf, b.nom_mf, a.fec_ini, a.fec_fin, a.dias from cb_vac_sol a, maefunc b
 where a.periodo = @fechaper and a.cod_mf = b.cod_mf  and ( a.cod_mf = @empleados
     OR '0' = @empleados )
 order by b.nom_mf, a.fec_ini
















SELECT B.NOM_EMP, C.RESPONS, D.DESCRIP, A.COD_MF, C.CB_GEID, TRIM(TRIM(C.PRI_APE_MF) || ' ' || TRIM(C.SEG_APE_MF)) || ',' || TRIM(TRIM(C.PRI_NOM_MF) || ' ' || TRIM(SEG_NOM_MF)) NOMBRE,
 C.FEC_ANTIG  , A.PERIODO, C.CENCOS_MF, A.DIAS_CALCULADOS, A.DIAS_TOMADOS, A.DIAS_CALCULADOS - A.DIAS_TOMADOS DIAS_RESTANTES, 
 	(SELECT SUM(F.DIAS) FROM CB_VAC_SOL F
 	 WHERE A.COD_MF =  F.COD_MF
     AND A.COD_EMP =  F.COD_EMP
     AND A.PERIODO =  F.PERIODO AND F.FEC_PEDIDO <= @FECHA ) AS DIAS_A_LA_FECHA,
     (SELECT SUM(F.DIAS) FROM CB_VAC_SOL F
 	 WHERE A.COD_MF =  F.COD_MF
     AND A.COD_EMP =  F.COD_EMP
     AND A.PERIODO =  F.PERIODO ) AS DIAS_TOTAL
    --,H.QS_CENCOS
  FROM CB_VAC A, QSEMPRESA B, MAEFUNC_TBL C, CB_RESPON D--, CB_VAC_SOL F--, CB_CENCOS H
  WHERE TO_CHAR(  A.PERIODO, 'YYYY') = @PERIODOHASTA
     AND A.COD_EMP = B.COD_EMP
     AND A.COD_MF = C.COD_MF
     AND C.FECHA_EFECTIVA = (SELECT MAX(FECHA_EFECTIVA) FROM MAEFUNC_TBL WHERE COD_MF = C.COD_MF AND to_char(FECHA_EFECTIVA,'yyyy') <= @PERIODOHASTA )
     AND C.SEC_EFECTIVA = (SELECT MAX(SEC_EFECTIVA) FROM MAEFUNC_TBL WHERE COD_MF = C.COD_MF AND FECHA_EFECTIVA = C.FECHA_EFECTIVA)
     AND C.RESPONS =  D.RESPONS(+)
	AND A.COD_EMP = @EMPRESA
     AND ( C.RESPONS = @RESPONSABLE
     OR '0' = @RESPONSABLE )
     AND A.COD_MF IN (SELECT DISTINCT COD_MF FROM MAEFUNC)    
     --AND C.COD_EMP = H.COD_EMP
     --AND C.CENCOS_MF = H.QS_CENCOS



SELECT A.COD_MF, A.PERIODO, A.DIAS_CALCULADOS, B.PERIODO, B.DIAS_CALCULADOS FROM CB_VAC A, CB_VAC B
  WHERE A.PERIODO = '31/12/2015' AND  A.COD_EMP IN (1,3) AND B.PERIODO = '31/12/2016' AND A.DIAS_CALCULADOS > B.DIAS_CALCULADOS
  AND A.COD_MF = B.COD_MF
  ORDER BY A.COD_MF




select distinct a.cod_mf, a.imptot_hd ,b.imptot_hd from movhd a, movhd b
where a.cod_mf = b.cod_mf and 
a.cod_lq = @LIQUIDACION and 
a.cod_mv = b.cod_mv and a.cod_mv = 6076
and b.cod_lq = @liquidacio2 and a.imptot_hd <> b.imptot_hd

