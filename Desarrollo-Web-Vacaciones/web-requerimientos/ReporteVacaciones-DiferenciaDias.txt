SELECT V.COD_MF, V.PERIODO, V.DIAS_TOMADOS, S.DIAS FROM CB_VAC V, (
select S.COD_MF, S.PERIODO, SUM(S.DIAS) AS DIAS from cb_vac_sol S
where periodo >= '01-jan-2017'
GROUP BY S.COD_MF, S.PERIODO) S
WHERE S.COD_MF = V.COD_MF
AND S.PERIODO = V.PERIODO
AND V.DIAS_TOMADOS <> S.DIAS



SELECT COUNT(*) FROM (SELECT V.COD_MF, V.PERIODO, V.LAST_USR, V.LAST_HOST, V.DIAS_CALCULADOS ,V.DIAS_TOMADOS, S.DIAS FROM CB_VAC V, (
  select S.COD_MF, S.PERIODO, SUM(S.DIAS) AS DIAS from cb_vac_sol S
  --where periodo >= '01-01-2010'
  GROUP BY S.COD_MF, S.PERIODO) S
WHERE S.COD_MF = V.COD_MF
AND S.PERIODO = V.PERIODO
AND V.DIAS_TOMADOS <> S.DIAS
AND V.DIAS_CALCULADOS >= S.DIAS
AND V.DIAS_TOMADOS = 0
AND V.COD_EMP IN (1, 3, 15)
ORDER BY V.PERIODO DESC
--ORDER BY V.PERIODO, V.COD_MF DESC
)